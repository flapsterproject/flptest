const SERVER_HOST="https://gs.eponesh.com/sdk";globalThis.C3.Plugins.GamePush_Channels.Instance=class extends globalThis.ISDKInstanceBase{constructor(e){super(),this.mappers={channelAclRoleWithMyPlayer:["myPlayer","owner","member","guest"],channelAclRole:["owner","member","guest"],channelAclAction:["canViewMessages","canAddMessage","canEditMessage","canDeleteMessage","canViewMembers","canInvitePlayer","canKickPlayer","canAcceptJoinRequest","canMutePlayer"],events:["event:invite","event:cancelInvite","event:rejectInvite","event:join","event:joinRequest","event:leave","event:cancelJoin","event:rejectJoinRequest","event:message","event:editMessage","event:deleteMessage","event:mute","event:unmute","event:updateChannel","event:deleteChannel"],leaveReasons:["leave","keck"],messageTargets:["CHANNEL","PERSONAL","FEED"],compare:[(e,t)=>e===t,(e,t)=>e!==t,(e,t)=>e<t,(e,t)=>e<=t,(e,t)=>t<e,(e,t)=>t<=e]},this.etos=function(e){return"string"==typeof e?e:"message"in e?e.message:String(e)},this.conditions=globalThis.C3.Plugins.GamePush_Channels.Cnds,this.actions=globalThis.C3.Plugins.GamePush_Channels.Acts,this.handleResult=(e,t)=>{this.isLastActionSuccess=!!e,t&&(this.lastError=this.etos(t),console.warn(t))},this.nextChannel={ownerAcl:null,memberAcl:null,guestAcl:null},this.curTag="",this.curTagIndex=0,this.channels={list:[],lastRequest:""},this.members={list:[],lastRequest:""},this.invites={list:[],lastRequest:""},this.joinRequests={list:[],lastRequest:""},this.messages={list:[],lastRequest:""},this.curChannel={},this.curChannelIndex=0,this.curMember={},this.curMemberIndex=0,this.curPlayer={},this.curPlayerIndex=0,this.curInvite={},this.curInviteIndex=0,this.curJoinRequest={},this.curJoinRequestIndex=0,this.curMessage={},this.curMessageIndex=0,this.curEvent={},this.leaveReason="",this.lastError="",this.isLastActionSuccess=!1;var t=this._getInitProperties();t&&(this.isEnabled=t[0],!this.isEnabled)?this.onError():this.init()}onError(){var e=()=>Promise.resolve({});this.gp={player:{id:0},channels:{on(){},sendInvite:e,cancelInvite:e,acceptInvite:e,rejectInvite:e,join:e,leave:e,cancelJoin:e,acceptJoinRequest:e,rejectJoinRequest:e,fetchMessages:e,fetchMoreMessages:e,sendMessage:e,sendFeedMessage:e,sendPersonalMessage:e,editMessage:e,deleteMessage:e,mute:e,unmute:e,fetchMembers:e,fetchMoreMembers:e,fetchInvites:e,fetchMoreInvites:e,fetchChannelInvites:e,fetchMoreChannelInvites:e,fetchSentInvites:e,fetchMoreSentInvites:e,fetchJoinRequests:e,fetchMoreJoinRequests:e,fetchSentJoinRequests:e,fetchMoreSentJoinRequests:e,kick:e,fetchChannel:e,fetchChannels:e,fetchMoreChannels:e,createChannel:e,updateChannel:e,deleteChannel:e,openChat:e}}}waitFor(n){return new Promise(e=>{let t=0;n(globalThis)?e():t=setInterval(function(){n(globalThis)&&(clearInterval(t),e())},10)})}init(){let e=!1;var t=this.runtime;if(t&&t.GamePush)return this.gp=t.GamePush,void(e||(e=!0,this.onReady()));this.waitFor(()=>{var e=this.runtime;return e&&e.GamePush}).then(()=>{this.gp=this.runtime.GamePush,e||(e=!0,this.onReady())})}onReady(){this.gp.channels.on("event",e=>{this.curEvent=e}),this.gp.channels.on("event:invite",e=>{this.curInvite={...e,playerTo:e.playerTo||{id:e.playerToId},playerFrom:e.playerFrom||{id:e.playerFromId},channel:e.channel||{id:e.channelId}},this.curInvite.playerTo.id===this.gp.player.id?this.curPlayer=this.curInvite.playerFrom:this.curPlayer=this.curInvite.playerTo,this.curChannel=this.curInvite.channel,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventInvite)}),this.gp.channels.on("event:cancelInvite",e=>{this.curInvite={...e,playerTo:e.playerFrom||{id:e.playerToId},playerFrom:e.playerFrom||{id:e.playerFromId},channel:e.channel||{id:e.channelId}},this.curPlayer=this.curInvite.playerTo,this.curChannel=this.curInvite.channel,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventCancelInvite)}),this.gp.channels.on("event:rejectInvite",e=>{this.curInvite={...e,playerTo:e.playerFrom||{id:e.playerToId},playerFrom:e.playerFrom||{id:e.playerFromId},channel:e.channel||{id:e.channelId}},this.curPlayer=this.curInvite.playerTo,this.curChannel=this.curInvite.channel,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventRejectInvite)}),this.gp.channels.on("event:join",e=>{this.curMember=e||{},this.curPlayer=e.state||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventJoin)}),this.gp.channels.on("event:joinRequest",e=>{this.curJoinRequest=e||{},this.curPlayer=e.player||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventJoinRequest)}),this.gp.channels.on("event:leave",e=>{this.curChannel={id:e.channelId},this.curPlayer={id:e.playerId},this.leaveReason=e.reason,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventLeave)}),this.gp.channels.on("event:cancelJoin",e=>{this.curChannel={id:e.channelId},this.curPlayer={id:e.playerId},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventCancelJoin)}),this.gp.channels.on("event:rejectJoinRequest",e=>{this.curChannel={id:e.channelId},this.curPlayer={id:e.playerId},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventRejectJoinRequest)}),this.gp.channels.on("event:message",e=>{this.curMessage=e||{},this.curPlayer=e.player||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventMessage)}),this.gp.channels.on("event:editMessage",e=>{this.curMessage=e||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventEditMessage)}),this.gp.channels.on("event:deleteMessage",e=>{this.curMessage=e||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventDeleteMessage)}),this.gp.channels.on("event:mute",e=>{this.curMember={id:e.playerId,channelId:e.channelId,state:{id:e.playerId},mute:{isMuted:!0,unmuteAt:e.unmuteAt}},this.curPlayer=this.curMember.state,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventMute)}),this.gp.channels.on("event:unmute",e=>{this.curMember={id:e.playerId,channelId:e.channelId,state:{id:e.playerId},mute:{isMuted:!1,unmuteAt:""}},this.curPlayer=this.curMember.state,this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventUnmute)}),this.gp.channels.on("event:updateChannel",e=>{this.curChannel=e||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventUpdateChannel)}),this.gp.channels.on("event:deleteChannel",e=>{this.curChannel=e||{},this._trigger(this.conditions.OnEvent),this._trigger(this.conditions.OnEventDeleteChannel)}),this.gp.channels.on("openChat",()=>this._trigger(this.conditions.OnOpenChat)),this.gp.channels.on("closeChat",()=>{this.handleResult(!0),this._trigger(this.conditions.OnCloseChat)}),this.gp.channels.on("error:openChat",e=>{this.handleResult(!1,e),this._trigger(this.conditions.OnOpenChatError)})}Release(){super.Release()}SaveToJson(){return{nextChannel:this.nextChannel,curTag:this.curTag,curTagIndex:this.curTagIndex,channels:this.channels,members:this.members,joinRequests:this.joinRequests,invites:this.invites,messages:this.messages,curChannel:this.curChannel,curChannelIndex:this.curChannelIndex,curMember:this.curMember,curMemberIndex:this.curMemberIndex,curPlayer:this.curPlayer,curPlayerIndex:this.curPlayerIndex,curJoinRequest:this.curJoinRequest,curJoinRequestIndex:this.curJoinRequestIndex,curInvite:this.curInvite,curInviteIndex:this.curInviteIndex,curMessage:this.curMessage,curMessageIndex:this.curMessageIndex,curEvent:this.curEvent,leaveReason:this.leaveReason,lastError:this.lastError,isLastActionSuccess:this.isLastActionSuccess}}LoadFromJson(e){this.nextChannel=e.nextChannel||{},this.curTag=e.curTag||"",this.curTagIndex=e.curTagIndex||0,this.channels=e.channels||{list:[],lastRequest:""},this.members=e.members||{list:[],lastRequest:""},this.invites=e.invites||{list:[],lastRequest:""},this.joinRequests=e.joinRequests||{list:[],lastRequest:""},this.messages=e.messages||{list:[],lastRequest:""},this.curChannel=e.curChannel||{},this.curChannelIndex=e.curChannelIndex||0,this.curMember=e.curMember||{},this.curMemberIndex=e.curMemberIndex||0,this.curPlayer=e.curPlayer||{},this.curPlayerIndex=e.curPlayerIndex||0,this.curInvite=e.curInvite||{},this.curInviteIndex=e.curInviteIndex||0,this.curJoinRequest=e.curJoinRequest||{},this.curJoinRequestIndex=e.curJoinRequestIndex||0,this.curMessage=e.curMessage||{},this.curMessageIndex=e.curMessageIndex||0,this.curEvent=e.curEvent||{},this.leaveReason=e.leaveReason||"",this.lastError=e.lastError||"",this.isLastActionSuccess=e.isLastActionSuccess||!1}_getDebuggerProperties(){return[]}};